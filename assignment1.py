# -*- coding: utf-8 -*-
"""assignment1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/15S_APUQq4xpTqU_DMnAcmIqbdG74qac4
"""

import pandas as pd
from pygam import LinearGAM, s

# Load training and test datasets
url_train = "https://github.com/dustywhite7/econ8310-assignment1/raw/main/assignment_data_train.csv"
url_test = "https://github.com/dustywhite7/econ8310-assignment1/raw/main/assignment_data_test.csv"
df_train = pd.read_csv(url_train)
df_test = pd.read_csv(url_test)

# Process the Timestamp column
df_train['Timestamp'] = pd.to_datetime(df_train['Timestamp'])
df_test['Timestamp'] = pd.to_datetime(df_test['Timestamp'])

# Extract features from Timestamp
for df in [df_train, df_test]:
    df['year'] = df['Timestamp'].dt.year
    df['month'] = df['Timestamp'].dt.month
    df['day'] = df['Timestamp'].dt.day
    df['hour'] = df['Timestamp'].dt.hour
    df['day_of_week'] = df['Timestamp'].dt.dayofweek

# Prepare the training and test data
X_train = df_train[['hour', 'day_of_week', 'month', 'year']].values  # Convert to NumPy
y_train = df_train['trips'].values  # Convert to NumPy
X_test = df_test[['hour', 'day_of_week', 'month', 'year']].values  # Convert to NumPy

# Initialize and fit the GAM model
model = LinearGAM(s(0) + s(1) + s(2) + s(3)).gridsearch(X_train, y_train)

# Predict the number of trips
predictions = model.predict(X_test)

# Save predictions to a CSV file
df_test['trips'] = predictions
df_test[['Timestamp', 'trips']].to_csv('taxi_trip_forecast_gam.csv', index=False)

# Display predictions
df_test.head()

!pip install pygam